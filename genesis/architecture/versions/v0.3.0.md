# Genesis Architecture v0.3.0

**Data:** 2024-12-13

**Status:** Em descoberta

---

## Visão

Genesis é um sistema autopoiético que:
1. Recebe dores de usuários via conversa
2. Identifica se já tem solução (produto existente)
3. Se não tem, constrói junto com o usuário (M0-M4)
4. Absorve o que construiu como nova capacidade
5. Melhora a si mesmo recursivamente

---

## Arquitetura Geral

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                              USUÁRIO                                        │
│                                                                             │
└───────────────────────────────────┬─────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             MATTERMOST                                      │
│                                                                             │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                     │
│   │   Thread    │    │   Thread    │    │   Canal     │                     │
│   │  Conversa   │    │  Projeto    │    │  Notifica   │                     │
│   └─────────────┘    └─────────────┘    └─────────────┘                     │
│                                                                             │
└───────────────────────────────────┬─────────────────────────────────────────┘
                                    │ Websocket
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              MM BOT                                         │
│                         (Listener/Publisher)                                │
│                                                                             │
│   • Escuta mensagens                                                        │
│   • Publica respostas                                                       │
│   • Nenhuma lógica de negócio                                               │
│                                                                             │
└───────────────────────────────────┬─────────────────────────────────────────┘
                                    │ REST
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                             CAMUNDA ENGINE                                  │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │                         KERNEL (imutável)                          │     │
│  │                                                                    │     │
│  │   conversation.bpmn    artifact_lifecycle.bpmn    tool_exec.bpmn   │     │
│  │                                                                    │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │                      GENERATED (Genesis cria)                      │     │
│  │                                                                    │     │
│  │   novos processos, decisões, subfluxos                             │     │
│  │                                                                    │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                             │
└───────────────────────────────────┬─────────────────────────────────────────┘
                                    │
                                    │ External Tasks
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              WORKERS                                        │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Contexto: intent_analyzer, context_retriever, capability_matcher   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  LLM: llm_generator, llm_fixer, llm_responder                       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  CI/CD: git_ops, docker_build, camunda_deploy, mongo_deploy         │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Validação: python_lint, python_test, bpmn_validate                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Integração: mm_notify, capability_index, history_persist           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└──────────┬─────────────────────┬─────────────────────┬──────────────────────┘
           │                     │                     │
           ▼                     ▼                     ▼
┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
│   ANTHROPIC     │   │     MONGODB     │   │     GITHUB      │
│     API         │   │                 │   │                 │
│                 │   │  • users        │   │  • prompts/     │
│  • Opus 4.5     │   │  • capabilities │   │  • workers/     │
│  • Web search   │   │  • history      │   │  • workflows/   │
│  • Tools        │   │  • embeddings   │   │  • decisions/   │
└─────────────────┘   └─────────────────┘   └─────────────────┘
```

---

## MCP como Adapter

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           ANTHROPIC API                                     │
│                                                                             │
│   LLM (Opus 4.5)                                                            │
│    │                                                                        │
│    │  Tools habilitadas:                                                    │
│    │  ├── web_search (nativo Anthropic)                                     │
│    │  ├── web_fetch (nativo Anthropic)                                      │
│    │  └── genesis_tools (custom) ───────────────────┐                       │
│    │                                                │                       │
└────┼────────────────────────────────────────────────┼───────────────────────┘
     │                                                │
     │                                                ▼
     │                                    ┌─────────────────────┐
     │                                    │    MCP SERVER       │
     │                                    │    (adapter fino)   │
     │                                    │                     │
     │                                    │  search_capabilities│
     │                                    │  read_code          │
     │                                    │  query_history      │
     │                                    │  start_process      │
     │                                    │                     │
     │                                    └──────────┬──────────┘
     │                                               │
     │                                               ▼
     │                                    ┌─────────────────────┐
     │                                    │      CAMUNDA        │
     │                                    │                     │
     │                                    │  tool_execution.bpmn│
     │                                    │                     │
     │                                    └──────────┬──────────┘
     │                                               │
     │                                               ▼
     │                                    ┌─────────────────────┐
     │                                    │      WORKERS        │
     │                                    │  (reusados)         │
     │                                    └─────────────────────┘
     │
     ▼
  Resposta para usuário via MM
```

---

## Roadmap de Fases

| Fase | Objetivo | Genesis consegue... |
|------|----------|---------------------|
| 0 | Kernel | Conversar no MM |
| 1 | Memória | Lembrar quem é o usuário |
| 2 | Consciência | Saber o que sabe fazer |
| 3 | Roteamento | Decidir entregar vs construir |
| 4 | Construção | Gerar, validar, deployar artefatos |
| 5 | MCP | Navegar conhecimento com autonomia |
| 6 | Auto-recursão | Melhorar a si mesmo |

---

## Decisões desta versão

- ADR-001: Mattermost como interface
- ADR-002: Camunda como orquestrador
- ADR-003: Workers reusáveis
- ADR-004: MCP via Camunda
- ADR-005: CI/CD via Camunda
- ADR-006: Kernel imutável

---

## Componentes por Fase

### Fase 0: Kernel
- MM Bot (listener/publisher)
- conversation.bpmn
- Worker: llm_responder
- Conexão Anthropic API

### Fase 1: Memória
- MongoDB: users, conversations
- Worker: context_retriever
- Worker: history_persist

### Fase 2: Consciência
- MongoDB: capabilities
- Embeddings
- Worker: capability_matcher
- Worker: capability_index

### Fase 3: Roteamento
- Worker: intent_analyzer
- DMN: route_intent.dmn
- DMN: match_capability.dmn

### Fase 4: Construção
- m0_m4_pipeline.bpmn
- artifact_lifecycle.bpmn
- Workers: llm_generator, llm_fixer
- Workers: git_ops, docker_build, camunda_deploy
- Workers: python_lint, python_test, bpmn_validate

### Fase 5: MCP
- MCP Server
- tool_execution.bpmn
- Tools: search_capabilities, read_code, query_history, start_process

### Fase 6: Auto-recursão
- Worker: meta_analyzer
- Capacidade de gerar prompts, workflows, workers para si mesmo

---

## Mudanças desde versão anterior

Primeira versão documentada formalmente.
